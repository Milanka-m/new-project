{"ast":null,"code":"import _asyncToGenerator from \"D:\\\\Lianok\\\\dev\\\\new-project\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\asyncToGenerator.js\";\nimport _regeneratorRuntime from \"D:\\\\Lianok\\\\dev\\\\new-project\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";\nimport { useCallback, useEffect } from 'react';\nimport logger from '../logger';\nimport useWalletHooks from './useWalletHooks';\n\nvar useGatekeeper = function useGatekeeper(_ref, state, dispatch) {\n  var wallet = _ref.wallet,\n      stage = _ref.stage,\n      gatekeeperClient = _ref.gatekeeperClient;\n\n  var _useWalletHooks = useWalletHooks(wallet, state, dispatch),\n      expectWalletConnected = _useWalletHooks.expectWalletConnected;\n\n  var gatekeeperNetworkAddress = state.gatekeeperNetworkAddress;\n  /**\r\n   * if a request is not already in progress, initiate a request to the gatekeeper for a new token\r\n   * and dispatch an event so we know it's in progress\r\n   */\n\n  var waitForGatekeeperIssuanceRequest = useCallback(\n  /*#__PURE__*/\n  // eslint-disable-next-line @typescript-eslint/no-shadow\n  function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(_ref2) {\n      var payload, proof, connectedWallet, requestGatewayTokenFromGatekeeperResult;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              payload = _ref2.payload, proof = _ref2.proof;\n              connectedWallet = expectWalletConnected();\n\n              if (!connectedWallet) {\n                _context.next = 15;\n                break;\n              }\n\n              logger.debug('waitForGatekeeperIssuanceRequest ready to call requestGatewayTokenFromGatekeeper', {\n                payload: payload\n              });\n              dispatch({\n                type: 'requestGatekeeperIssuance'\n              });\n              _context.next = 7;\n              return gatekeeperClient().requestGatewayTokenFromGatekeeper({\n                wallet: connectedWallet,\n                payload: payload,\n                proof: proof\n              });\n\n            case 7:\n              requestGatewayTokenFromGatekeeperResult = _context.sent;\n              logger.debug('requestGatewayTokenFromGatekeeperResult', requestGatewayTokenFromGatekeeperResult);\n\n              if (!(requestGatewayTokenFromGatekeeperResult.status >= 400)) {\n                _context.next = 13;\n                break;\n              }\n\n              logger.error('Error requesting token from gatekeeper');\n              dispatch({\n                type: 'requestGatekeeperIssuanceFailed'\n              });\n              throw new Error('Error requesting token from gatekeeper');\n\n            case 13:\n              logger.debug('Successfully created gatekeeper token');\n              dispatch({\n                type: 'requestGatekeeperIssuanceComplete'\n              });\n\n            case 15:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function (_x) {\n      return _ref3.apply(this, arguments);\n    };\n  }(), [gatekeeperClient, expectWalletConnected, stage]);\n  /**\r\n   * Update the state when the Gatekeeper network changes\r\n   */\n\n  useEffect(function () {\n    if (wallet && wallet.publicKey && gatekeeperNetworkAddress) {\n      dispatch({\n        type: 'gatekeeperNetworkChanged',\n        gatekeeperNetworkAddress: gatekeeperNetworkAddress\n      });\n    }\n  }, [gatekeeperNetworkAddress]);\n  return {\n    waitForGatekeeperIssuanceRequest: waitForGatekeeperIssuanceRequest,\n    gatekeeperClient: gatekeeperClient\n  };\n};\n\nexport default useGatekeeper;","map":{"version":3,"sources":["D:/Lianok/dev/new-project/node_modules/@civic/solana-gateway-react/dist/esm/useHooks/useGatekeeper.js"],"names":["useCallback","useEffect","logger","useWalletHooks","useGatekeeper","state","dispatch","wallet","stage","gatekeeperClient","expectWalletConnected","gatekeeperNetworkAddress","waitForGatekeeperIssuanceRequest","payload","proof","connectedWallet","debug","type","requestGatewayTokenFromGatekeeper","requestGatewayTokenFromGatekeeperResult","status","error","Error","publicKey"],"mappings":";;AAAA,SAASA,WAAT,EAAsBC,SAAtB,QAAuC,OAAvC;AACA,OAAOC,MAAP,MAAmB,WAAnB;AACA,OAAOC,cAAP,MAA2B,kBAA3B;;AACA,IAAMC,aAAa,GAAG,SAAhBA,aAAgB,OAAuCC,KAAvC,EAA8CC,QAA9C,EAA2D;AAAA,MAAxDC,MAAwD,QAAxDA,MAAwD;AAAA,MAAhDC,KAAgD,QAAhDA,KAAgD;AAAA,MAAzCC,gBAAyC,QAAzCA,gBAAyC;;AAC7E,wBAAkCN,cAAc,CAACI,MAAD,EAASF,KAAT,EAAgBC,QAAhB,CAAhD;AAAA,MAAQI,qBAAR,mBAAQA,qBAAR;;AACA,MAAQC,wBAAR,GAAqCN,KAArC,CAAQM,wBAAR;AACA;AACJ;AACA;AACA;;AACI,MAAMC,gCAAgC,GAAGZ,WAAW;AAAA;AACpD;AADoD;AAAA,yEAEpD;AAAA;AAAA;AAAA;AAAA;AAAA;AAASa,cAAAA,OAAT,SAASA,OAAT,EAAkBC,KAAlB,SAAkBA,KAAlB;AACUC,cAAAA,eADV,GAC4BL,qBAAqB,EADjD;;AAAA,mBAEQK,eAFR;AAAA;AAAA;AAAA;;AAGQb,cAAAA,MAAM,CAACc,KAAP,CAAa,kFAAb,EAAiG;AAC7FH,gBAAAA,OAAO,EAAPA;AAD6F,eAAjG;AAGAP,cAAAA,QAAQ,CAAC;AAAEW,gBAAAA,IAAI,EAAE;AAAR,eAAD,CAAR;AANR;AAAA,qBAO8DR,gBAAgB,GAAGS,iCAAnB,CAAqD;AACvGX,gBAAAA,MAAM,EAAEQ,eAD+F;AAEvGF,gBAAAA,OAAO,EAAPA,OAFuG;AAGvGC,gBAAAA,KAAK,EAALA;AAHuG,eAArD,CAP9D;;AAAA;AAOcK,cAAAA,uCAPd;AAYQjB,cAAAA,MAAM,CAACc,KAAP,CAAa,yCAAb,EAAwDG,uCAAxD;;AAZR,oBAaYA,uCAAuC,CAACC,MAAxC,IAAkD,GAb9D;AAAA;AAAA;AAAA;;AAcYlB,cAAAA,MAAM,CAACmB,KAAP,CAAa,wCAAb;AACAf,cAAAA,QAAQ,CAAC;AAAEW,gBAAAA,IAAI,EAAE;AAAR,eAAD,CAAR;AAfZ,oBAgBkB,IAAIK,KAAJ,CAAU,wCAAV,CAhBlB;;AAAA;AAkBQpB,cAAAA,MAAM,CAACc,KAAP,CAAa,uCAAb;AACAV,cAAAA,QAAQ,CAAC;AAAEW,gBAAAA,IAAI,EAAE;AAAR,eAAD,CAAR;;AAnBR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAFoD;;AAAA;AAAA;AAAA;AAAA,OAuBjD,CAACR,gBAAD,EAAmBC,qBAAnB,EAA0CF,KAA1C,CAvBiD,CAApD;AAwBA;AACJ;AACA;;AACIP,EAAAA,SAAS,CAAC,YAAM;AACZ,QAAIM,MAAM,IAAIA,MAAM,CAACgB,SAAjB,IAA8BZ,wBAAlC,EAA4D;AACxDL,MAAAA,QAAQ,CAAC;AAAEW,QAAAA,IAAI,EAAE,0BAAR;AAAoCN,QAAAA,wBAAwB,EAAxBA;AAApC,OAAD,CAAR;AACH;AACJ,GAJQ,EAIN,CAACA,wBAAD,CAJM,CAAT;AAKA,SAAO;AACHC,IAAAA,gCAAgC,EAAhCA,gCADG;AAEHH,IAAAA,gBAAgB,EAAhBA;AAFG,GAAP;AAIH,CA3CD;;AA4CA,eAAeL,aAAf","sourcesContent":["import { useCallback, useEffect } from 'react';\r\nimport logger from '../logger';\r\nimport useWalletHooks from './useWalletHooks';\r\nconst useGatekeeper = ({ wallet, stage, gatekeeperClient, }, state, dispatch) => {\r\n    const { expectWalletConnected } = useWalletHooks(wallet, state, dispatch);\r\n    const { gatekeeperNetworkAddress } = state;\r\n    /**\r\n     * if a request is not already in progress, initiate a request to the gatekeeper for a new token\r\n     * and dispatch an event so we know it's in progress\r\n     */\r\n    const waitForGatekeeperIssuanceRequest = useCallback(\r\n    // eslint-disable-next-line @typescript-eslint/no-shadow\r\n    async ({ payload, proof }) => {\r\n        const connectedWallet = expectWalletConnected();\r\n        if (connectedWallet) {\r\n            logger.debug('waitForGatekeeperIssuanceRequest ready to call requestGatewayTokenFromGatekeeper', {\r\n                payload,\r\n            });\r\n            dispatch({ type: 'requestGatekeeperIssuance' });\r\n            const requestGatewayTokenFromGatekeeperResult = await gatekeeperClient().requestGatewayTokenFromGatekeeper({\r\n                wallet: connectedWallet,\r\n                payload,\r\n                proof,\r\n            });\r\n            logger.debug('requestGatewayTokenFromGatekeeperResult', requestGatewayTokenFromGatekeeperResult);\r\n            if (requestGatewayTokenFromGatekeeperResult.status >= 400) {\r\n                logger.error('Error requesting token from gatekeeper');\r\n                dispatch({ type: 'requestGatekeeperIssuanceFailed' });\r\n                throw new Error('Error requesting token from gatekeeper');\r\n            }\r\n            logger.debug('Successfully created gatekeeper token');\r\n            dispatch({ type: 'requestGatekeeperIssuanceComplete' });\r\n        }\r\n    }, [gatekeeperClient, expectWalletConnected, stage]);\r\n    /**\r\n     * Update the state when the Gatekeeper network changes\r\n     */\r\n    useEffect(() => {\r\n        if (wallet && wallet.publicKey && gatekeeperNetworkAddress) {\r\n            dispatch({ type: 'gatekeeperNetworkChanged', gatekeeperNetworkAddress });\r\n        }\r\n    }, [gatekeeperNetworkAddress]);\r\n    return {\r\n        waitForGatekeeperIssuanceRequest,\r\n        gatekeeperClient,\r\n    };\r\n};\r\nexport default useGatekeeper;\r\n"]},"metadata":{},"sourceType":"module"}